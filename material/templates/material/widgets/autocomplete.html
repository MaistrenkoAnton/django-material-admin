<input type="{{ widget.type }}"
     autocomplete="off"
     {% if widget.value != None %} value="{{ widget.value|stringformat:'s' }}"{% endif %}
     {% include "django/forms/widgets/attrs.html" %}>

<input type="hidden"
     name="{{ widget.name }}"
     class="autocomplete-value"
     {% if widget.value != None %} value="{{ widget.value|stringformat:'s' }}"{% endif %}>

<script>
  $(document).ready(function(){
    var initChoices = {
        {% for choice in widget.choices %}
          "{{ choice.0 }}": "{{ choice.1 }}",
        {% endfor %}
    };
    var initValue = initChoices['{{ widget.value }}'];
    if (initValue) {
       $('input.autocomplete').val(initValue);
    }

    $('input.autocomplete').autocomplete({
      data: {
        {% for choice in widget.choices %}
            "{{ choice.1 }}": null,
        {% endfor %}
      },
      onAutocomplete: function (item) {
        var choices = {
            {% for choice in widget.choices %}
                "{{ choice.1 }}": "{{ choice.0 }}",
            {% endfor %}
          }
          $('input.autocomplete-value').val(choices[item]);
      }
    });
  });
</script>
